<% value_key = [@field_group.record_type, @field_group.record_id, @field_group.kind].compact.join(',') %>
<%= javascript_include_tag "camaleon_cms/admin/custom_fields_form" %>
<div class="page-title">
    <h2><span class="fa fa-cog"></span> <%= @field_group.new_record? ? t('camaleon_cms.admin.settings.new_custom_field_group') : "#{t('camaleon_cms.admin.settings.new_custom_field_group')}: #{@field_group.name} "%> </h2>
</div>

<!-- PAGE CONTENT WRAPPER -->
<div class="page-content-wrap" id="cama_custom_field_form" data-group_class_name="<%= @field_group.record_type %>,<%= @field_group.record_id %>">
    <div class="row">
        <%= form_for @field_group, as: "custom_field_group", url:{action: @field_group.new_record? ? :create : :update}, html: {class: 'validate-custom-field validate cama_ajax_request'} do |f| %>
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title"><%= t('camaleon_cms.admin.settings.details_custom_field_group') %></h3>
                    </div>
                    <div class="panel-body">
                        <%= render partial: 'layouts/camaleon_cms/admin/form_error', locals: {data: @field_group} %>
                        <div class="form-group">
                            <%= f.label t('camaleon_cms.admin.table.name') %><br>
                            <%= f.text_field :name, :class => "form-control required" %>
                        </div>
                        <div class="form-group hidden">
                            <%#= f.label t('camaleon_cms.admin.table.slug') %><br>
                            <%#= f.text_field :slug, :class => "form-control slug", "data-parent" => 'custom_field_group_name' %>
                        </div>
                        <div class="form-group">
                            <%= f.label t('camaleon_cms.admin.custom_field.custom_group_support_multiple', default: 'Support multiple groups?') %><br>
                            <%= f.check_box :is_repeat, :class => "" %>
                        </div>
                        <div class="form-group">
                            <%= f.label t('camaleon_cms.admin.table.description') %><br>
                            <%= f.text_area :description, :class => "form-control" %>
                        </div>
                        <div class="form-group">
                            <%= f.label t('camaleon_cms.admin.settings.where_display_group') %><br>
                            <select id="select_assign_group" name="custom_field_group[assign_group]" class="form-control required" data-value="<%= value_key %>">
                                <option value="">&nbsp;</option>

                                <optgroup label="<%= cama_t('admin.settings.field_groups.type_labels.common') %> PostType">
                                  <% current_site.post_types.map(&:decorate).each do |pt| %>
                                      <option value="<%= "#{Cama::PostType.base_class.name},#{pt.id}" %>"><%= pt.the_title %></option>
                                  <% end  %>
                                </optgroup>

                                <optgroup label="<%= cama_t('admin.settings.field_groups.type_labels.posts') %>">
                                    <% current_site.post_types.map(&:decorate).each do |pt| %>
                                        <option value="<%= "#{Cama::PostType.base_class.name},#{pt.id},Post" %>"><%= pt.the_title %></option>
                                    <% end  %>
                                </optgroup>

                                <optgroup label="<%= cama_t('admin.settings.field_groups.type_labels.categories') %>">
                                    <% current_site.post_types.map(&:decorate).each do |pt| %>
                                        <% if pt.manage_categories? %>
                                            <option value="<%= "#{Cama::PostType.base_class.name},#{pt.id},Category" %>"><%= pt.the_title %></option>
                                        <% end %>
                                    <% end  %>
                                </optgroup>

                                <optgroup label="<%= cama_t('admin.settings.field_groups.type_labels.tags') %>">
                                    <% current_site.post_types.map(&:decorate).each do |pt| %>
                                        <% if pt.manage_tags? %>
                                            <option value="<%= "#{Cama::PostType.base_class.name},#{pt.id},PostTag" %>"><%= pt.the_title %></option>
                                        <% end %>
                                    <% end  %>
                                </optgroup>

                                <optgroup label="<%= t('camaleon_cms.admin.settings.others') %>">
                                    <% value = "#{PluginRoutes.static_system_info['user_model'].presence || Cama::User.base_class.name},#{current_site.id}" %>
                                    <option value="<%= value %>"><%= t('camaleon_cms.admin.sidebar.users') %></option>
                                    <option value="<%= Cama::Site.base_class.name %>"><%= t('camaleon_cms.admin.sidebar.site_settings') %></option>
                                    <% f_args={models: @_extra_models_for_fields || []}; hooks_run('custom_field_custom_models', f_args); f_args[:models].each do |model| %>
                                        <% value = "#{model.name},#{current_site.id}" %>
                                        <option value="<%= value %>"><%= model.name %></option><%= model.name %>
                                    <% end %>
                                </optgroup>

                                <optgroup label="<%= cama_t('admin.settings.field_groups.type_labels.common') %> Theme">
                                    <option value="<%= "#{CamaleonCms::Theme.base_class.name},#{current_theme.id}" %>" data-help=""><%= current_theme.name %></option>
                                </optgroup>

                                <optgroup label="<%= cama_t('admin.settings.field_groups.type_labels.common') %> Menus">
                                    <% current_site.nav_menus.each do |menu| %>
                                        <option value="<%= "#{CamaleonCms::NavMenu.base_class.name},#{menu.id}" %>" data-help=""><%= menu.name %></option>
                                    <% end %>
                                </optgroup>
                                <option value="_post_simple" ><%= cama_t('admin.settings.field_groups.type_labels.single_post') %></option>
                            </select>

                          <!-- select post -->
                            <select id="select_post_simple" name="custom_field_group[assign_group]" class="form-control required" style="display: none" disabled>
                                <% current_site.post_types.each do |pt| pt = pt.decorate %>
                                    <optgroup label="PostType <%= pt.the_title %>: <%= cama_t('admin.settings.field_groups.type_labels.common') %> Post">
                                        <% pt.posts.visible_frontend.map(&:decorate).each do |post| %>
                                            <option value="<%= "#{Cama::Post.base_class.name},#{post.id}" %>"><%= post.the_title %></option>
                                        <% end %>
                                    </optgroup>
                                <% end %>
                            </select>
                            <input id="select_assign_group_caption" type="hidden" name="custom_field_group[caption]"/>
                            <div id="select_assign_group_help"></div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <a class="btn btn-default" role="back" href="<%= url_for action: :index %>"><%= t('camaleon_cms.admin.button.back') %></a>
                        <button class="btn btn-primary pull-right" type="submit"><%= t('camaleon_cms.admin.button.submit') %></button>
                    </div>
                </div>
            </div>
            <div class="col-md-5">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title"><%= t('camaleon_cms.admin.settings.fields') %></h3>
                    </div>
                    <div class="panel-body padding-0">
                        <% fields =  @field_group.new_record? ? [] : @field_group.fields %>
                        <ul id="sortable-fields" class="clear list-unstyled">
                            <% fields.each do |field| @item_value = field; @item_options_value = field.options; @key = field.options[:field_key] %>
                                <li class="item">
                                    <%= render "get_items" %>
                                </li>
                            <% end  %>
                        </ul>
                    </div>
                    <div class="panel-footer hidden">
                        <a class="btn btn-default" role="back" href="<%= url_for action: :index %>"><%= t('camaleon_cms.admin.button.back') %></a>
                        <button class="btn btn-primary pull-right" type="submit"><%= t('camaleon_cms.admin.button.submit') %></button>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title"><%= t('camaleon_cms.admin.settings.available_fields')%></h3>
                    </div>
                    <div class="panel-body">
                        <div id="content-items-default" class="form-group input-group-sm">
                            <% cama_custom_field_elements.each do |i,item| %>
                                <% next if item[:key] == "select_eval" %>
                                <a id="item-<%= item[:key] %>" class="btn btn-default" href="<%= get_items_cama_admin_settings_custom_fields_path(item[:key]) %>" style="margin-bottom: 4px"><%= item[:label] %></a>
                            <% end %>
                        </div>
                    </div>
                    <div class="panel-footer hidden">
                        <a class="btn btn-default" role="back" href="<%= url_for action: :index %>"><%= t('camaleon_cms.admin.button.back') %></a>
                        <button class="btn btn-primary pull-right" type="submit"><%= t('camaleon_cms.admin.button.submit') %></button>
                    </div>
                </div>
            </div>
        <% end %>
    </div>
</div>



